<div class="body">

  <!--Header-->
  <app-header></app-header>

  <!-- Spinner -->
  <ngx-spinner bdColor="rgba(0,0,0,0.8)" size="large" color="#00a7f8" type="ball-spin-clockwise"></ngx-spinner>

  <!-- Main content -->
  <main>
    <div class="container">
      
      <!-- Title -->
      <div class="row">
        <div class="col s12">
          <h3 class="header"><a [routerLink]="['/assessment']">Avaliações</a> > {{ assessment.name }}</h3>
        </div>
      </div>

      <!-- Assessment info -->
      <div class="row">
        <div class="col s12">
          <h5>Informações da avaliação</h5>
          <!--<p class="grey-text text-darken-2">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam ex dolor, hendrerit vitae rutrum quis, pharetra eu augue. Proin id nunc lacinia, placerat est at, varius ante. Donec nec ipsum nibh.</p>-->
        </div>
      </div>
      <div class="row">
        <form class="col s12">
          <div class="row">
            <div class="input-field col s12 m6">
              <i class="material-icons prefix">description</i>
              <input id="icon_prefix" type="text" class="validate" value="{{ assessment.name }}">
              <label class="active" for="icon_prefix">Nome</label>
            </div>
            <div class="input-field col s12 m6">
              <i class="material-icons prefix">location_city</i>
              <input disabled id="icon_telephone" type="tel" class="validate" value="{{ organization.name }}">
              <label class="active" for="icon_telephone">Organização</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12 m6">
              <i class="material-icons prefix">account_circle</i>
              <input disabled id="icon_prefix" type="text" class="validate" value="{{ assessment.userCreator }}">
              <label class="active" for="icon_prefix">Autor</label>
            </div>
            <div class="input-field col s12 m6">
              <i class="material-icons prefix">edit</i>
              <input disabled id="icon_telephone" type="tel" class="validate" value="{{ filterTool(assessment.tool) }}">
              <label class="active" for="icon_telephone">Ferramenta</label>
            </div>
          </div>
          <div class="row">
            <div class="input-field col s12 m6">
              <i class="material-icons prefix">pan_tool</i>
              <label class="active" for="publics">Pública</label>
              <select #public id="public" class="validate">
                <option *ngFor='let option of publicOptions' [value]="option.value" [selected]="option.value === assessment.public">
                  {{ option.description }}
                </option>
              </select>
            </div>
          </div>
        </form>
      </div>

      <!-- Questions -->
      <div class="row">
        <div class="col s12">
            <h5>Questões</h5>
        </div>
      </div>
      <div class="row">
        <div class="col s12">
          <ul class="collapsible" *ngIf="assessment.questions.length>0">
            <li *ngFor="let question of assessment.questions; let i = index" (click)="collapsible()">
              <div class="collapsible-header">{{ i+1 }} - {{ question.name | slice:0:40 }}{{ question.name.length > 40 ? '...' : ''}}</div>
              <div class="collapsible-body">
                <span>
                  <p><b>Questão:</b>{{ question.name }}</p>
                  <p><b>Competência:</b>{{ question.competenceName }}</p>
                  <p><b>Peso:</b>{{ question.significance + '%' }}</p>
                  <!-- Alternatives -->
                  <div class="row" *ngIf="question.items.length>0">
                    <div class="col s12 m4" *ngFor="let item of question.items; let j = index">
                      <div class="card blue-grey darken-1">
                        <div class="card-content white-text">
                          <p><b>Alternativa {{ j+1 }}</b></p>
                          <p><b>Peso: </b>{{ item.percentage + '%'}}</p>
                          <p>{{ item.description }}</p>
                        </div>
                        <div class="card-action">
                          <a style="cursor: pointer;" (click)="deleteAlternative(i,j)">Excluir</a>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Buttons to add alternative or edit question -->
                  <div class="row">
                    <div class="col s12">
                      <a class="waves-effect waves-light light-blue btn-small modal-trigger" href="#addEditAlternative" (click)="addAlternativeModal(i)"><i class="material-icons left">add</i>Adicionar alternativa</a>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col s12">
                      <a class="waves-effect waves-light light-blue btn-small modal-trigger" href="#addEditQuestion" (click)="editQuestionModal(i)"><i class="material-icons left">edit</i>Editar questão</a>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col s12">
                      <a class="waves-effect waves-light light-blue btn-small" (click)="deleteQuestion(i)"><i class="material-icons left">delete</i>Excluir questão</a>
                    </div>
                  </div>
                </span>
              </div>
            </li>
          </ul>
          <div class="row">
            <div class="col s12">
              <a class="waves-effect waves-light light-blue btn-small modal-trigger" href="#addEditQuestion" (click)="addQuestionModal()"><i class="material-icons left">add</i>Adicionar questão</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="row">
        <div class="col s12">
          <a style="margin-top: 4px; margin-bottom: 4px; margin-right: 4px;" class="waves-effect waves-light light-blue btn-large" [routerLink]="['/assessment']"><i class="material-icons left">arrow_back</i>Voltar</a>
          <a *ngIf="assessment.public" style="margin: 4px;" class="waves-effect waves-light light-blue btn-large" (click)="copyAssessment()"><i class="material-icons left">content_copy</i>Copiar</a>
          <a class="waves-effect waves-light light-blue btn-large right" (click)="save()"><i class="material-icons left">save</i>Salvar</a>
        </div>
      </div>


      <!-- Modal to add or edit alternative -->
      <div id="addEditAlternative" class="modal modal-fixed-footer addEditAlternative">
        <div class="modal-content">
          <h4>Adicionar ou editar alternativa na questão</h4>
          <div class="row">
            <form class="col s12">
              <div class="row">
                <div class="input-field col s12 m6">
                  <i class="material-icons prefix">description</i>
                  <input #description id="description" type="text" class="validate" value="{{ alternative.description }}">
                  <label for="description">Descrição</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12 m6">
                  <i class="material-icons prefix">format_list_numbered</i>
                  <input #percentage id="percentage" type="number" class="validate" value="{{ alternative.percentage }}">
                  <label for="percentage" class="active">Porcentagem</label>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="modal-footer">
          <a class="modal-close waves-effect waves-green btn-flat">Cancelar</a>
          <a class="modal-close waves-effect waves-light light-blue btn" (click)="addAlternative(description.value, percentage.value)">Salvar</a>
        </div>
      </div>

      <!-- Modal to add or edit question -->
      <div id="addEditQuestion" class="modal modal-fixed-footer addEditQuestion">
        <div class="modal-content">
          <h4>Adicionar ou editar questão na avaliação</h4>
          <p>
            Adicione uma questão do tipo {{ filterTool(assessment.tool) }} na avaliação {{ assessment.name }}.
          </p>
          <div class="row">
            <form class="col s12">
              <div class="row">
                <div class="input-field col s12 m6">
                  <i class="material-icons prefix">description</i>
                  <input #question id="question" type="text" class="validate" value="{{ q.name }}">
                  <label for="question" class="active">Questão</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12 m6">
                  <i class="material-icons prefix">description</i>
                  <label for="competence" class="active">Competência</label>
                  <select #competence id="competence" class="validate">
                      <option *ngFor='let competence of organization.competences' [value]="competence.name" [selected]="competence.name === q.competenceName">
                        {{ competence.name }}
                      </option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12 m6">
                  <i class="material-icons prefix">description</i>
                  <input #significance id="significance" type="number" class="validate" value="{{ q.significance }}">
                  <label for="significance" class="active">Peso</label>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="modal-footer">
          <a class="modal-close waves-effect waves-green btn-flat">Cancelar</a>
          <a class="modal-close waves-effect waves-light light-blue btn" (click)="addEditQuestion(question.value, competence.value, significance.value)">Salvar</a>
        </div>
      </div>


    </div>
  </main>

  <!-- Footer -->
  <app-footer></app-footer>

</div>
